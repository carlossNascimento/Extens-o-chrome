<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Hello World PWA</title>
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#1976d2" />
    <style>
      body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; padding:24px; background:#f3f6fb }
      .card { max-width:480px; margin:40px auto; background:#fff; padding:20px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.08)}
      button { background:#1976d2;color:#fff;border:0;padding:10px 16px;border-radius:8px;cursor:pointer }
      .muted { color:#666; font-size:0.9rem }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Hello, World! (PWA)</h1>
      <p class="muted">This is the converted Chrome extension running as a Progressive Web App.</p>
      <p>
        <button id="fetchApi">Call API</button>
      </p>
      <div id="apiResult" data-testid="api-ok" style="margin-top:12px;color:#1976d2"></div>
      <p style="margin-top:16px" class="muted">You can install this as a PWA (when served over HTTPS).</p>
    </main>

    <script>
      const apiResult = document.getElementById('apiResult');
      document.getElementById('fetchApi').addEventListener('click', async () => {
        apiResult.textContent = 'Loading...';
        try {
          const res = await fetch('/api/hello');
          const json = await res.json();
          apiResult.textContent = json?.msg || JSON.stringify(json);
        } catch (e) {
          apiResult.textContent = 'Error calling API: ' + e.message;
        }
      });

      // register service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js').then(() => console.log('SW registered'))
          .catch(err => console.warn('SW registration failed', err));
      }
    </script>
  </body>
</html>
